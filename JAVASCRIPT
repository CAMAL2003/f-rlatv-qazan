const wheel = document.getElementById('wheel');
const ctx = wheel.getContext('2d');
const spinBtn = document.getElementById('spin-btn');
const balanceDisplay = document.getElementById('balance');
const adCounterDisplay = document.getElementById('ad-counter');
const watchAdBtn = document.getElementById('watch-ad-btn');
let balance = 0;
let adsWatched = 0;

const sectors = [
    { label: "0.01 AZN", probability: 0.50 },
    { label: "0.02 AZN", probability: 0.25 },
    { label: "0.03 AZN", probability: 0.10 },
    { label: "0.05 AZN", probability: 0.05 },
    { label: "0.00 AZN", probability: 0.15 }
];

const totalDegrees = 360;
const sectorDegrees = totalDegrees / sectors.length;

// Çarxı çəkmək
function drawWheel() {
    const colors = ['#FF5733', '#33FF57', '#3357FF', '#FF33A6', '#F5FF33'];
    let startAngle = 0;

    sectors.forEach((sector, index) => {
        const endAngle = startAngle + sectorDegrees * Math.PI / 180;

        ctx.beginPath();
        ctx.moveTo(150, 150);
        ctx.arc(150, 150, 150, startAngle, endAngle);
        ctx.fillStyle = colors[index % colors.length];
        ctx.fill();

        ctx.fillStyle = '#000';
        ctx.font = '16px Arial';
        ctx.fillText(sector.label, 150 + Math.cos((startAngle + endAngle) / 2) * 100, 150 + Math.sin((startAngle + endAngle) / 2) * 100);

        startAngle = endAngle;
    });
}

// Reklam izləmək
watchAdBtn.addEventListener('click', () => {
    if (adsWatched < 5) {
        adsWatched++;
        adCounterDisplay.innerText = `Reklamlar izlənib: ${adsWatched}/5`;
        
        if (adsWatched >= 5) {
            spinBtn.disabled = false;
        }
    }
});

// Fırlatmaq
spinBtn.addEventListener('click', function() {
    const randomValue = Math.random();
    let totalProbability = 0;
    let winningSector = 0;

    for (let i = 0; i < sectors.length; i++) {
        totalProbability += sectors[i].probability;
        if (randomValue <= totalProbability) {
            winningSector = i;
            break;
        }
    }

    const spinAngle = Math.random() * totalDegrees;
    const winningAngle = spinAngle + sectorDegrees * winningSector;
    const spinDuration = 3;

    wheel.style.transition = `transform ${spinDuration}s ease-out`;
    wheel.style.transform = `rotate(${spinAngle + totalDegrees * 5}deg)`;

    setTimeout(() => {
        wheel.style.transition = "none";
        wheel.style.transform = `rotate(${winningAngle}deg)`;
        balance += parseFloat(sectors[winningSector].label);
        balanceDisplay.innerText = `Balans: ${balance.toFixed(2)} AZN`;
        alert(`Qazanılan: ${sectors[winningSector].label}`);

        // Çıxarış üçün minimum məbləğ
        if (balance >= 1) {
            alert('Minimum çıxarış məbləği 1 AZN-ə çatdı!');
        }
    }, spinDuration * 1000);
});

drawWheel();
